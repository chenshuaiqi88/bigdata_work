# 完成工单
**一、DWD 层（明细数据层）**

DWD 层主要做 **原始数据清洗和标准化**，每条记录都是明细级别的数据。

1. **`dwd_product_visit_detail`（商品访问明细）**

    - **作用**：记录用户访问商品详情页的明细数据。

    - **字段示例**：`user_id`, `product_id`, `shop_id`, `visit_time`, `visit_reason`, `visit_count`, `stay_time`, `has_click`, `terminal_type`

    - **功能**：

        - 用于统计商品访客数、浏览量、跳出率等访问行为指标。

        - 支持按终端类型（PC/无线端）分析访问情况。

2. **`dwd_product_favorite_detail`（商品收藏明细）**

    - **作用**：记录用户收藏商品的行为明细。

    - **字段示例**：`user_id`, `product_id`, `shop_id`, `favorite_time`, `is_cancel`, `terminal_type`

    - **功能**：

        - 用于统计收藏人数、收藏转化率。

        - 能分析用户在不同时间维度的收藏行为。

3. **`dwd_product_cart_detail`（商品加购明细）**

    - **作用**：记录用户将商品加入购物车的行为。

    - **字段示例**：`user_id`, `product_id`, `shop_id`, `cart_time`, `terminal_type`

    - **功能**：

        - 用于统计加购人数、加购转化率。

        - 可分析不同时间段、不同终端的加购行为。

4. **`dwd_order_detail`（订单明细）**

    - **作用**：记录订单中的商品信息及用户下单行为。

    - **字段示例**：`order_detail_id`, `order_id`, `product_id`, `quantity`, `price`, `order_time`, `user_id`, `shop_id`, `terminal_type`

    - **功能**：

        - 用于计算支付金额、下单转化率、客单价。

        - 支持区分新老买家、不同终端支付情况。


---

## **二、DWS 层（汇总指标层）**

DWS 层主要做 **多表聚合和指标计算**，用于统计关键指标和分析维度。

1. **`dws_product_agg`（商品汇总指标表）**

    - **作用**：把 DWD 层的访问、收藏、加购、下单数据汇总到商品维度。

    - **字段示例**：`shop_id`, `product_id`, `visitor_count`, `pv`, `bounce_rate`, `favorite_count`, `cart_count`, `order_count`, `pay_amount`, `ds`

    - **功能**：

        - 统计商品访客数、浏览量、收藏人数、加购人数、下单人数、支付金额等核心指标。

        - 为 ADS 层提供基础指标计算。

        - 可按日期、商品、店铺聚合。

2. **`dws_product_new_old_buyer`（支付新老买家汇总）**

    - **作用**：统计商品在统计周期内的新老支付买家人数。

    - **字段示例**：`shop_id`, `product_id`, `pay_new_buyer_count`, `pay_old_buyer_count`, `ds`

    - **功能**：

        - 为商品支付转化率和客单价提供新老买家分析维度。

        - 支持新老买家区分，便于营销策略分析。


---

## **三、ADS 层（主题分析层 / 指标汇总层）**

ADS 层主要做 **指标汇总、区间分析、报表输出**，面向业务使用。

1. **`ads_product_result_dt`（商品效率监控指标汇总表）**

    - **作用**：汇总商品在店铺内的访问、收藏、加购、支付情况，形成核心运营指标。

    - **字段示例**：`shop_id`, `product_id`, `visitor_count`, `pv`, `bounce_rate`, `favorite_count`, `cart_count`, `order_count`, `pay_amount`, `pay_new_buyer_count`, `pay_old_buyer_count`, `visit_to_favorite_rate`, `visit_to_cart_rate`, `visit_to_order_rate`, `pay_conversion_rate`, `unit_price`, `ds`

    - **功能**：

        - 商品效率监控：访问/收藏/加购/下单转化率、支付转化率、客单价。

        - 支持时间维度分析（1d、7d、30d）。

        - 面向运营决策、商品动销分析。

2. **`ads_product_segment_analysis_dt`（商品区间分析表）**

    - **作用**：按价格带、支付件数区间、支付金额区间统计商品销售表现。

    - **字段示例**：`dt`, `shop_id`, `price_band`, `order_band`, `amount_band`, `product_count`, `total_pay_amount`, `total_pay_quantity`, `avg_unit_price`, `ds`

    - **功能**：

        - 支持区间分析和排序：动销商品数、支付金额、支付件数、件单价。

        - 辅助商品精细化运营，发现不同价格带、销量带商品表现。

        - 支持按日期分区统计，便于多周期对比。


ads_product_ranking_all 表分析

### 表结构分析

**核心定位**: 商品综合表现排行榜，为商家提供全面的商品运营决策支持

**关键字段分析**:

1. **销售维度指标群**

    - `sales_amount` + `sales_amount_rank`: 商品销售额核心指标，识别高价值商品

    - `sales_quantity` + `sales_quantity_rank`: 商品销量指标，识别热销商品

    - `order_count`: 订单数量，反映商品交易频次

2. **流量维度指标群**

    - `visitor_count` + `visitor_rank`: 商品访客规模，衡量商品吸引力

    - `pv`: 页面浏览量，反映商品详情页的访问深度

    - `bounce_rate`: 跳出率，衡量商品页面内容质量

3. **转化维度指标群**

    - `pay_conversion_rate` + `conversion_rank`: 核心转化指标，计算公式=支付买家数/访客数

    - `favorite_count`: 收藏量，反映用户购买意愿强度

    - `cart_count`: 加购量，反映用户即时购买意向


**数据关联关系**:

sql

-- 主要数据来源
dws_product_agg (70%) ← 提供流量、行为、基础销售指标
dwd_order_detail (30%) ← 提供详细的销售明细数据

**业务应用场景**:

1. **商品分层运营**: 通过多维度排名识别明星商品、问题商品、潜力商品

2. **资源分配决策**: 基于销售额和转化率排名分配推广资源

3. **商品策略优化**: 分析高转化商品的共性特征，复制成功经验


**数据质量要点**:

- 支付转化率需处理除零问题

- 排名计算需确保同一商品在不同时间周期的一致性

- 销售额与销量需保持逻辑一致性


## 2、ads_product_sku_sales 表分析

### 表结构分析

**核心定位**: SKU粒度销售分析，支持库存管理和商品规格优化

**关键字段分析**:

1. **销售表现指标**

    - `pay_quantity`: SKU销售件数，反映各规格的实际销售情况

    - `quantity_ratio`: 销售占比，计算公式=当前SKU销量/商品总销量

    - `sales_rank`: 销售排名，识别最受欢迎的SKU规格

2. **库存管理指标**

    - `current_stock`: 当前库存量，需对接库存系统

    - `stock_sale_days`: 库存可售天数，计算公式=当前库存/日均销量


**数据关联关系**:

sql

-- 主要数据来源
dwd_order_detail (主要) ← 提供SKU粒度的销售数据
dim_product_sku (维度) ← 提供SKU属性信息（当前实现中缺失）
inventory_table (库存) ← 提供库存数据（当前实现中缺失）

**业务应用场景**:

1. **库存预警**: 基于库存可售天数及时补货或促销

2. **规格优化**: 识别畅销和滞销SKU，优化商品规格组合

3. **采购决策**: 根据SKU销售趋势制定精准采购计划

4. **促销策略**: 对滞销SKU制定针对性的促销方案


**数据质量要点**:

- SKU信息需要完整的商品主数据支持

- 库存数据需要实时或准实时更新

- 销售占比计算需确保分母不为零


## 3、ads_product_traffic_source 表分析

### 表结构分析

**核心定位**: 商品流量渠道效果分析，优化流量来源结构

**关键字段分析**:

1. **流量规模指标**

    - `visitor_count`: 各渠道带来的访客数量

    - `traffic_rank`: 渠道流量排名，识别主要流量来源

2. **转化效果指标**

    - `pay_buyer_count`: 各渠道产生的支付买家数

    - `pay_conversion_rate`: 渠道转化率，计算公式=支付买家数/访客数


**流量来源分类**（基于业务理解）:

sql

-- 主要流量渠道类型
'手淘搜索'     -- 自然搜索流量
'效果广告'     -- 付费广告流量  
'内容广告'     -- 内容营销流量
'购物车'       -- 复购流量
'我的淘宝'     -- 用户主动访问
'站外广告'     -- 外部渠道流量

**数据关联关系**:

sql

-- 主要数据来源
dwd_product_visit_detail (主要) ← 通过visit_reason识别流量来源
dwd_order_detail (关联) ← 关联访问与购买行为

**业务应用场景**:

1. **渠道效果评估**: 对比各渠道的流量质量和转化效率

2. **投放策略优化**: 加大高转化渠道的投入，减少低效渠道支出

3. **流量结构优化**: 平衡免费流量与付费流量的比例

4. **用户行为分析**: 理解不同渠道用户的购买偏好


**数据质量要点**:

- 流量来源识别依赖visit_reason字段的规范性

- 渠道归因逻辑需要明确（首次接触/最后接触）

- 跨渠道用户的去重处理

- TOP10排名的稳定性保障


---

### **总结逻辑**

- **DWD**：原始行为数据（访问、收藏、加购、订单）

- **DWS**：指标计算与汇总（访客数、支付金额、新老买家）

- **ADS**：业务分析表（效率监控、区间分析），支持运营决策和报表输出